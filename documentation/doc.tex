% Dokumentace projektu GAL 2014
% Vendula Poncová, xponco00
% Alena Chernikava, xcerni07

\documentclass[a4paper, 11pt, titlepage, final]{article}[3. prosinec 2011]

\newcommand{\uv}[1]{\quotedblbase #1\textquotedblleft}
\newcommand{\mensi}{$<$}
\newcommand{\vetsi}{$>$}

\usepackage[left=2.5cm,text={16cm, 25cm},top=2cm]{geometry}
\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
\usepackage[IL2]{fontenc}
\usepackage[dvipdf]{graphicx}
\usepackage{color}

\newcommand{\url}[1]{\textit{#1}}
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% titulni strana - DON'T TOUCH! MAGIC!

\begin{titlepage}
\begin{center}

\textsc{
\Large Fakulta informačních technologií 
\medskip\\
Vysoké učení technické v~Brně}

\vspace{\stretch{0.190}}

{\parbox{5cm}{\centering\includegraphics[height=5cm]{img/logo.eps}}}

\vspace{\stretch{0.190}}

{\LARGE Dokumentace projektu do předmětu GAL} \medskip \\
{\Large Paralelizace Egerváryho algoritmu} 


\vspace{\stretch{0.618}}

\end{center}

{\large
Tým 33

Vendula Poncová (\texttt{xponco00})

Alena Chernikava (\texttt{xcerni07})
} \hfill {\large\today}

\end{titlepage}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% text dokumentace

\pagenumbering{arabic}
\setcounter{page}{1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Úvod}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Egerváryho algoritmus}


\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/bipartite.eps}
  \caption{Bipartitní graf a maximální párování v tomto grafu.}
  \label{imgBipartite}
\end{figure}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/mpath.eps}
  \caption{M-rozšiřující cesta a nové párování M'.}
  \label{imgPath}
\end{figure}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/trees.eps}
  \caption{M-pokrytý u-strom a M-alternující u-strom.}
  \label{imgTrees}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Sekvenční varianta algoritmu}

\subsection{Datové typy a struktury}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/implementation.eps}
  \caption{Datové struktury uzlu a stromu.}
  \label{imgStructure}
\end{figure}

\subsection{Popis implementace}


\subsection{Spuštění aplikace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Paralelní varianta algoritmu}

\subsection{Analýza problému}

V popisu Egerváryho algoritmu si lze všimnout, že se vždy pracuje pouze s vytvářeným stromem a jeho nejbližším okolím. Pokud je nalezena $M$-rozšiřující cesta, dochází ke změnám na hranách, které patří do tohoto stromu, pokud je nalezen APS strom, přebarví se pouze uzly tohoto stromu.

Jako přirozený způsob paralelizace Egerváryho algoritmu se nabízí zpracovávání grafu více procesy tak, že každý proces bude vytvářet vlastní strom. Pokud bychom zaručily, že takové stromy budou vždy navzájem disjuktní, s ohledem na předcházející paragraf by paralelní zpracování nijak neovlivnilo fungování Egerváryho algoritmu. Na víceprocesorových počítačích by se však výpočet urychlil.

Disjuktnost stromů ale zaručit nemůžeme, proto je třeba najít způsob, jak se vypořádat s konflikty mezi stromy. Obecná situace je taková, že proces $1$ buduje strom $T_1$, proces $2$ buduje strom $T_2$ a proces $1$ bude chtít k uzlu $v_1$ svého stromu $T_1$ připojit uzel $v_2$ stromu $T_2$. Podle barev uzlů $v_1$ a $v_2$ rozlišujeme následující typy konfliktů.

Konflikt typu B-B je konflikt mezi modrým uzlem $v_1$ a modrým uzlem $v_2$. Příklad takového konfliktu je na obrázku \ref{imgXX}. Na obrázku si můžeme všimnout toho, že v takovém případě existuje $M$-rozšiřující cesta z kořene stromu $T_1$ do kořene stromu $T_2$. Nalezení cesty je žádoucí, proto pokud dojde k takovému konfliktu, lze zastavit růst obou stromů, upravit párování na hranách nalezené cesty a uzly ve stromech přebarvit na bílo, aby byly k dispozici dalším stromům. Konflikt typu R-R pro červené uzly $v_1$, $v_2$ je analogický konfliktu B-B (viz. \ref{imgXX}).

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/XXconflicts.eps}
  \caption{Konflikty B-B a R-R.}
  \label{imgXX}
\end{figure}

Konflikt typu R-B je konflikt mezi červených uzlem $v_1$ a modrým uzlem $v_2$. Na obrázku \ref{imgXY} vidíme, že v tomto případě se $M$-rozšiřující cesta nevytvoří. Nabízí se několik možných řešení. Strom $T_1$ by mohl získat uzel $v_2$, pak by ale strom $T2$ nemohl pokračovat ve výpočtu a všechny jeho uzly by musely být obarveny na bílo a uvolněny. Stejně tak by mohl $T_1$ prohrát uzel $v_2$, $T_2$ by dál pokračoval ve výpočtu a $T_1$ by se ukončil. Třetí možností je ignorace konfliktní hrany. $T_2$ by dál pokračoval ve výpočtu, nijak neovlivněn tímto konfliktem. $T_1$ by taktéž pokračoval ve výpočtu, ale pokud by skončil nalezením APS stromu, tak by své uzly obarvil na bílo a vytvořený strom zahodil.

Konflikt typu B-R je konflikt mezi modrým uzlem $v_1$ a červeným uzlem $v_2$. Z obrázku \ref{imgXY} je patrné, že v takovém případě by z uzlu $v_2$ vedly dvě hrany náležící párování $M$. $M$ by potom nebylo platné párování. Párování může být dočasně neplatné jen v případě, že nějaký strom nalezl $M$-rozšiřující cestu a upravuje párování na hranách této cesty. Pokud jsou oba stromy $T_1$, $T_2$ ve fázi růstu pak párování na hranách vycházejících z uzlů těchto dvou stromů je platné a neměnné. V našem případě předpokládáme, že oba stromy rostou, proto k B-R konfliktu nemůže dojít.

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/XYconflicts.eps}
  \caption{Konflikty R-B a B-R.}
  \label{imgXY}
\end{figure}

Dále je třeba uvažovat o způsobu, jakým se budou synchronizovat procesy. Je zřejmé, že je třeba zaručit, aby s každým uzlem pracoval v jeden okamžik nejvýše jeden proces. Potom bude třeba sychnronizovat přístup ke stromům uzlů. Pokud bychom se inspirovaly návrhem sekvenčního algoritmu, pak informaci o stavu stromu nese pouze strom. Pak při každém přístupu k uzlu je potřeba nejprve zamknout příslušný strom a pak teprve uzel. Pokud očekáváme konflikt, je třeba zamknout oba stromy a konfliktní uzly. Druhou možností je propagovat informaci o stavu stromu do jeho uzlů. Pro přístup k uzlu by pak stačilo zamknutí uzlu.

\subsection{Návrh řešení}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/inconflict.eps}
  \caption{Řešení R-B konflitu.}
  \label{imgConflict}
\end{figure}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.5]{img/haspath.eps}
  \caption{Řešení R-R a B-B konfliktu.}
  \label{imgHasPath}
\end{figure}

\subsection{Datové typy a struktury}

\subsection{Popis implementace}

\subsection{Spuštění aplikace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Experimenty}

\subsection{Generování vstupních souborů}

Pro vygenerování vstupních souborů jsme v jazyce \texttt{python 2.7} s použitím knihovny \texttt{python-igraph 0.7} napsaly skript \texttt{generator.py}. 
Skript generuje bipartitní neorientované grafy $G=(X,Y,E)$ a ukladá je do souborů \texttt{graph\_x\_y\_p\_m}, kde $x$ je počet uzlů v množině $X$, $y$ je počet uzlů v množině $Y$, $p$ je procentuální vyjádření počtu hran množiny $E$ a $m$ je počet hran v maximálním párování. Pak soubor obsahuje počet uzlů množiny $X \cup Y$, počet hran množiny $E$ a výčet všech dvojic uzlů, mezi kterými existuje v $E$ hrana, přičemž každá hrana je reprezentovaná právě jednou.

Skript je umístěný ve složce \texttt{graph}. Příkazem \texttt{python2.7 generator.py} se podle parametrů nastavených ve scriptu vygeneruje soubor s náhodným grafem. Příkaz \texttt{python2.7 generator.py test} vygeneruje všechny testovací soubory pro naše experimenty. Knihovna \texttt{python-igraph} na školním serveru \texttt{merlin} není dostupná, proto v archivu odevzdáváme část testovacích souborů.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Závěr}

%------------------------------------------------------------------------
\begin{thebibliography}{1}
  
  \bibitem{bondy:2008} BONDY, J. A. a U. S. R. MURTY. \emph{Graph theory}. New York: Springer, 2008, xii, 651 s. ISBN 978-1-84628-969-9. 
  
  \bibitem{igraph:2003} \emph{Python-igraph} [online]. \copyright 2003-2013 [cit. 2014-12-13]. Dostupné z: http://igraph.org/python/ 

\end{thebibliography}


%------------------------------------------------------------------------
\end{document}

% end of file
